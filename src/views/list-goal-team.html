<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="../public/img/introduction/icon.png">
  <title>Scope Tour</title>
  <!-- Boostrap -->
  <link href="../public/css/main.min.css" rel="stylesheet">

  <!-- Main style and font-awesome icon -->
  <link rel="stylesheet" href="../public/css/main-style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
  <!-- Sidebar -->
  <link rel="stylesheet" href="../public/css/list-goal-team.css">

  <!-- Multiple emails in input -->
  <link rel="stylesheet" href="../public/css/multiple-emails-input/email.css">
  <link rel="stylesheet" href="../public/css/multiple-emails-input/examples.css">
  <script type="text/javascript" src="../js/list-goal-team-sidebar.js" defer></script>
</head>
<body>
  <!--Begin: SideBar -->
  <custom-sidebar data-active-menu="team"></custom-sidebar>
  <!--End: SideBar -->
  
  <!--Begin: Main Content -->
  <main>
    <!--Begin: Header -->
    <div id="header">
      <div class="header-user">
        <div class="user-avatar">
          <i class="fa-solid fa-circle-user"></i>
        </div>
        <div class="user-name">
          <h3 class="my-0">Tr·∫ßn Quang Hi·∫øu</h3>
        </div>
        <div class="user-streak">
          <img src="../public/img/list-team-goal/slider2.png" alt="" class="icon-streak">
          <div class="number-streak">
            <span>30</span>
          </div>
        </div>
      </div>

      <div class="header-time">
        <h4 class="time my-0">
          9:41
        </h4>
      </div>
    </div>
    <!--End: Header -->
    
    <!-- Begin: Button List -->
    <div id="buttons">
      <div class=" button-list">
        <div class="create-btn">
          <button data-bs-toggle="modal" 
          data-bs-target="#reg-modal">
            <i class="fa-solid fa-circle-plus"></i>
            <span>Create</span>
          </button>
        </div> 

        <div class="search-btn">
          <input  type="email" placeholder="Seach your team name" required="" name="" id="" class="email">
          <i class="fa-solid fa-magnifying-glass"></i>
        </div>

        <ul>
          <li>
            <i class="fa-solid fa-trash-can"></i>
            <span>Delete</span>
          </li>
          <li>
            <i class="fa-solid fa-filter"></i>
            <span>Filter</span>
          </li>
          <li>
            <i class="fa-solid fa-sort"></i>
            <span>Sort</span>
          </li>
        </ul>
      </div>
    </div>


   <!-- fade: hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªïi m·ªü d·∫ßn khi modal xu·∫•t hi·ªán ho·∫∑c bi·∫øn m·∫•t -->
   <!-- MODAL CREATE TEAM -->
   <div class="modal fade" id="reg-modal" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modal-title">Create a team</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <!-- Only one form tag with id="createTeamForm" -->
        <form id="createTeamForm">
          <div class="modal-body">
            <label for="modal-team-name" class="form-label my-1">
              <span>Team name</span>
              <div class="icon-important">
                <i class="fa-solid fa-asterisk"></i>
              </div>
            </label>
            <input type="text" class="form-control mb-3" id="modal-team-name" required placeholder="Rumble Team">
            <label class="form-label my-1">Invite team member</label>
            <div id="sample1"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Create</button>
          </div>
        </form>
      </div>
    </div>
  </div>
    <!-- End: Button List -->
    <!-- End: Team List -->

  </main>
  <!--End: Main Content -->

     
      <!-- End: Button List -->
  
      <!-- (Optional) Team list container -->
      <ol id="teamList" class="olcards"></ol>
    </main>
    <!-- End: Main Content -->
  
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Attach event listener only when the DOM is fully loaded
        const createTeamForm = document.getElementById('createTeamForm');
        if (createTeamForm) {
          createTeamForm.addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent default form submission
  
            const teamName = document.getElementById('modal-team-name').value;
            if (!teamName) {
              alert('Please enter a team name.');
              return;
            }
  
            try {
              const response = await fetch('http://localhost:3000/api/team', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({ teamName })
              });
              const result = await response.json();
              if (response.ok) {
                alert(result.message);
                // Optionally, fetch and update the team list without reloading:
                fetchTeams();
                // Hide the modal using the correct modal id "reg-modal"
                const modalElement = document.getElementById('reg-modal');
                const modal = bootstrap.Modal.getInstance(modalElement);
                modal.hide();
              } else {
                alert(result.message || 'An error occurred while creating the team.');
              }
            } catch (error) {
              console.error('Error:', error);
              alert('An error occurred.');
            }
          });
        }
  
        // Fetch teams from the backend and render them in the team list
        async function fetchTeams() {
          try {
            const res = await fetch('http://localhost:3000/api/team');
            const data = await res.json();
            const teamList = document.getElementById('teamList');
            if (teamList) {
              teamList.innerHTML = '';
              if (data.teams && data.teams.length > 0) {
                data.teams.forEach(team => {
                  const li = document.createElement('li');
                  li.style.setProperty('--cardColor', '#E08963');
                  li.innerHTML = `
                    <div class="content">
                      <div class="icon">üòÅ</div>
                      <div class="team-des">
                        <div class="title">${team.name}</div>
                      </div>
                      <div class="team-streak">
                        <img src="../public/img/list-team-goal/slider2.png" alt="streak" class="icon-streak">
                        <div class="number-streak"><span>30</span></div>
                      </div>
                    </div>`;
                  teamList.appendChild(li);
                });
              } else {
                teamList.innerHTML = '<li>No teams available</li>';
              }
            }
          } catch (error) {
            console.error('Error fetching teams:', error);
          }
        }
      });
    </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </script>

  <script src="../js/multiple-emails-input/utils.js"></script>
  <script src="../js/multiple-emails-input/emails-input.js"></script>
  <script src="../js/multiple-emails-input/examples.js"></script>

  <script src="../js/component.js"></script>

</body>
</html>